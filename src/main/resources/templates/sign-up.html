<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Sign Up</title>
	<meta name="description" content="#">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Bootstrap core CSS -->
	<link href="css/lib/bootstrap.min.css" type="text/css" rel="stylesheet">
	<!-- Swipe core CSS -->
	<link href="css/swipe.min.css" type="text/css" rel="stylesheet">
	<!-- Favicon -->
	<link href="img/favicon.png" type="image/png" rel="icon">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>


<!--	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>-->
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<!-- Popper.js and Bootstrap JS -->
	<script src="js/vendor/popper.min.js"></script>
	<script src="js/bootstrap.min.js"></script>

</head>

<style>

	/*hide egde eyes*/
	input[type="password"]::-ms-reveal,
	input[type="password"]::-ms-clear {
		display: none;
	}

	.password-container {
		position: relative;
	}

	.password-container input {
		width: 100%;
		padding-right: 40px;
	}

	.password-toggle {
		position: absolute;
		right: 10px;
		top: 50%;
		transform: translateY(-50%);
		cursor: pointer;
		color: #888;
	}

</style>

<body class="start">
<main>
	<div class="layout">
		<!-- Start of Sign Up -->
		<div class="aside order-md-2">
			<div class="container">
				<div class="col-md-12">
					<div class="preference">
						<h2>Hello, Friend!</h2>
						<p>Enter your personal details and start your journey with Chatroom today.</p>
						<a href="login" class="btn button">Sign Up</a>
					</div>
				</div>
			</div>
		</div>
		<div class="main order-md-2">
			<div class="start">
				<div class="container">
					<div class="col-md-12">
						<div class="content">
							<h1>Create Account</h1>
<!--							<div class="third-party">-->
<!--								<button class="btn item bg-blue">-->
<!--									<i class="material-icons">pages</i>-->
<!--								</button>-->
<!--								<button class="btn item bg-teal">-->
<!--									<i class="material-icons">party_mode</i>-->
<!--								</button>-->
<!--								<button class="btn item bg-purple">-->
<!--									<i class="material-icons">whatshot</i>-->
<!--								</button>-->
<!--							</div>-->
<!--							<p>or use your email for registration:</p>-->
							<form id="signupForm" class="signup">
								<div class="form-group">
									<div class="form-group">
										<input type="text" id="inputLastName" name="LastName" class="form-control" placeholder="Last Name" required>
									</div>
									<div class="form-group">
										<input type="text" id="inputFirstName" name="FirstName" class="form-control" placeholder="First Name" required>
									</div>
<!--								</div>-->
<!--								<div class="form-parent">-->
									<div class="form-group">
										<input type="text" id="inputUserName" name="username" class="form-control" placeholder="Username" required>
									</div>
									<div class="form-group">
										<input type="email" id="inputEmail" name="email" class="form-control" placeholder="Email Address" required>
									</div>

<!--								</div>-->
								<div class="form-group">
									<div class="password-container">
										<input type="password" name="password" id="inputPassword" class="form-control" placeholder="Password">
										<i id="togglePassword1" class="fa fa-eye password-toggle"></i>
									</div>
								</div>

								<div class="form-group">
									<div class="password-container">
										<input type="password" id="confirmPassword" class="form-control" placeholder="Confirm Password">
										<i id="togglePassword2" class="fa fa-eye password-toggle"></i>
									</div>
								</div>

								<button type="submit" class="btn button">Sign Up</button>
								<div class="callout">
									<span>Already a member? <a href="login">Sign In</a></span>
								</div>
							</form>
							<div class="alert alert-light hide" role="alert" id="alert" style="display: none;">
								Loading...
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- End of Sign Up -->
	</div> <!-- Layout -->
</main>

<!-- Bootstrap core JavaScript -->
<!--<script src="../static/js/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>-->
<!--<script>window.jQuery || document.write('<script src="../static/js/vendor/jquery-slim.min.js"><\/script>')</script>-->
<!--<script src="../static/js/vendor/popper.min.js"></script>-->
<!--<script src="../static/js/bootstrap.min.js"></script>-->

<script src="/js/jquery-3.3.1.slim.min.js" integrity="sha256-fNXJFIlca05BIO2Y5zh1xrShK3ME+/lYZ0j+ChxX2DA=" crossorigin="anonymous"></script>
<!--<script src="/js/jquery-3.3.1.slim.min.js"  crossorigin="anonymous"></script>-->
<script>window.jQuery || document.write('<script src="/js/vendor/jquery-slim.min.js"><\/script>')</script>
<script src="/js/vendor/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script>
	// <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>


	document.addEventListener("DOMContentLoaded", function () {
		document.querySelectorAll(".password-toggle").forEach(icon => {
			icon.addEventListener("click", function () {
				const input = this.previousElementSibling;
				if (input.type === "password") {
					input.type = "text";
					this.classList.replace("fa-eye", "fa-eye-slash");
				} else {
					input.type = "password";
					this.classList.replace("fa-eye-slash", "fa-eye");
				}
			});
		});
	});


	document.getElementById("signupForm").addEventListener("submit", function (event) {
		event.preventDefault();

		const alertLoading = document.getElementById("alert");
		const passwordInput = document.getElementById("inputPassword");
		const confirmPasswordInput = document.getElementById("confirmPassword");
		const lastNameInput = document.getElementById("inputLastName");
		const firstNameInput = document.getElementById("inputFirstName");
		const emailInput = document.getElementById("inputEmail");
		const usernameInput = document.getElementById("inputUserName");

		const password = passwordInput.value.trim();
		const confirmPassword = confirmPasswordInput.value.trim();

		passwordInput.setCustomValidity("");
		confirmPasswordInput.setCustomValidity("");

		let hasError = false;

		if (password.length < 8) {
			passwordInput.setCustomValidity("Password must contain at least 8 characters.");
			hasError = true;
		} else if (confirmPassword !== password) {
			confirmPasswordInput.setCustomValidity("Passwords do not match.");
			hasError = true;
		}

		if (hasError) {
			passwordInput.reportValidity();
			confirmPasswordInput.reportValidity();
			passwordInput.value = "";
			confirmPasswordInput.value = "";
			return;
		}
		alertLoading.style.display = "block";
		const formData = {
			lastName: lastNameInput.value,
			firstName: firstNameInput.value,
			email: emailInput.value,
			username: usernameInput.value,
			password: password
		};

		fetch("http://localhost:8080/api/auth/register", {
			method: "POST",
			headers: {
				"Content-Type": "application/json"
			},
			body: JSON.stringify(formData)
		})
				.then(response => response.json())
				.then(data => {
					if (alertLoading) alertLoading.style.display = "none";
					if (data.status === "success") {
						alert("Verify message has been sent to your email. Please check your mail.");
						// window.location.href = "/sign-in.html"; // Redirect to login page
						lastNameInput.value = "";
						firstNameInput.value = "";
						emailInput.value = "";
						usernameInput.value = "";
						passwordInput.value = "";
						confirmPasswordInput.value = "";
					} else {
						alert(data.message || "Some errors occurred.");

						lastNameInput.value = "";
						firstNameInput.value = "";
						emailInput.value = "";
						usernameInput.value = "";
						passwordInput.value = "";
						confirmPasswordInput.value = "";
					}
				})
				.catch(error => {
					if (alertLoading) alertLoading.style.display = "none";
					alert("There are some errors in the registration step: " + error);

					lastNameInput.value = "";
					firstNameInput.value = "";
					emailInput.value = "";
					usernameInput.value = "";
					passwordInput.value = "";
					confirmPasswordInput.value = "";
				});
	});

	document.getElementById("inputPassword").addEventListener("input", function () {
		this.setCustomValidity("");
	});
	document.getElementById("confirmPassword").addEventListener("input", function () {
		this.setCustomValidity("");
	});


</script>
</body>

</html>
